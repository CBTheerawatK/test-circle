machine:
  node:
    version: 6.5.0
  post:
    - npm install -g npm@3.x.x

test:
  pre:
    - rm -rf dist tmp
  override:
    - npm run build-heroku

deployment:
  production:
    branch: circleci
    commands:
      - APP_NAME="test-heroku-1213"
      - rm -rf heroku-deployment
      - git clone --depth 1 git@heroku.com:${APP_NAME}.git heroku-deployment
      - rm -rf heroku-deployment/*
      - cp heroku/* heroku-deployment
      - mv dist heroku-deployment
      - git config user.email "tesserax@cubiccreative.org"
      - git config user.name "Tesserax"
      - git add -A:
          pwd: heroku-deployment
      - git commit -m "heroku deployment":
          pwd: heroku-deployment
      - git push -f git@heroku.com:${APP_NAME}.git HEAD:master:
          pwd: heroku-deployment
